app-id: org.openttd.OpenTTD
runtime: org.freedesktop.Platform
runtime-version: '20.08'
sdk: org.freedesktop.Sdk
command: openttd
rename-icon: openttd
rename-desktop-file: openttd.desktop
finish-args:
  - --device=dri
  - --filesystem=home
  - --share=ipc
  - --share=network
  - --socket=pulseaudio
  - --socket=x11
modules:
  - name: fluidsynth
    buildsystem: cmake
    config-opts:
      - -DLIB_INSTALL_DIR:STRING=lib
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
      - /share
    sources:
      - type: archive
        url: https://github.com/FluidSynth/fluidsynth/archive/v2.1.8.tar.gz
        sha256: a254efceff5d99f8d658d12d25318317f37307e6df852ec9baeb7da173496967
        x-checker-data:
          type: anitya
          project-id: 10437
          stable-only: true
          url-template: https://github.com/FluidSynth/fluidsynth/archive/v$version.tar.gz

  - name: opl3-soundfont
    buildsystem: simple
    build-commands:
      - install -D -m 644 -t $FLATPAK_DEST/share/soundfonts OPL-3_FM_128M.sf2
      - ln -s $FLATPAK_DEST/share/soundfonts/{OPL-3_FM_128M,default}.sf2
    sources:
      - type: archive
        url: https://musical-artifacts.com/artifacts/15/OPL-3_FM_128M.zip
        sha256: 0ab38927549179aeb2289493e271bf16a681fd4192d16b027d0460533c4d9257

  - name: lzo
    config-opts:
      - --enable-shared
      - --disable-static
    cleanup:
      - /include
      - /lib/*.la
      - /lib/pkgconfig
      - /share
    sources:
      - type: archive
        url: https://www.oberhumer.com/opensource/lzo/download/lzo-2.10.tar.gz
        sha256: c0f892943208266f9b6543b3ae308fab6284c5c90e627931446fb49b4221a072
        x-checker-data:
          type: anitya
          project-id: 1868
          stable-only: true
          url-template: https://www.oberhumer.com/opensource/lzo/download/lzo-$version.tar.gz

  - name: openttd
    config-opts:
      - -DCMAKE_BUILD_TYPE:STRING=RelWithDebInfo
      - -DCMAKE_INSTALL_BINDIR:STRING=bin
    buildsystem: cmake-ninja
    builddir: true
    post-install:
      - install -D -m 644 -t $FLATPAK_DEST/share/icons/hicolor/scalable/apps ../media/openttd.svg
      - install -D -m 644 -t $FLATPAK_DEST/share/metainfo ../org.openttd.OpenTTD.metainfo.xml
    sources:
      - type: archive
        url: https://cdn.openttd.org/openttd-releases/1.11.1/openttd-1.11.1-source.tar.xz
        sha256: a9919e2e429bb08fa29fe8e67ba9bc75c90e9ef6fa64248eb34223a325d400a3
        x-checker-data:
          type: anitya
          project-id: 8640
          stable-only: true
          url-template: https://cdn.openttd.org/openttd-releases/$version/openttd-$version-source.tar.xz
          is-main-source: true
      - type: file
        path: org.openttd.OpenTTD.metainfo.xml

  - name: openttd-opengfx
    buildsystem: simple
    build-commands:
      - tar -x -f opengfx-*.tar && rm opengfx-*.tar
      - mv opengfx-* $FLATPAK_DEST/share/games/openttd/baseset/opengfx
    sources:
      - type: archive
        url: https://cdn.openttd.org/opengfx-releases/0.6.1/opengfx-0.6.1-all.zip
        sha256: c694a112cd508d9c8fdad1b92bde05e7c48b14d66bad0c3999e443367437e37e
        x-checker-data:
          type: anitya
          project-id: 9200
          stable-only: true
          url-template: https://cdn.openttd.org/opengfx-releases/$version/opengfx-$version-all.zip

  - name: openttd-openmsx
    buildsystem: simple
    build-commands:
      - tar -x -f openmsx-*.tar && rm openmsx-*.tar
      - mv openmsx-* $FLATPAK_DEST/share/games/openttd/baseset/openmsx
    sources:
      - type: archive
        url: https://cdn.openttd.org/openmsx-releases/0.4.0/openmsx-0.4.0-all.zip
        sha256: 7698cadf06c44fb5e847a5773a22a4a1ea4fc0cf45664181254656f9e1b27ee2
        x-checker-data:
          type: anitya
          project-id: 88822
          stable-only: true
          url-template: https://cdn.openttd.org/openmsx-releases/$version/openmsx-$version-all.zip

  - name: openttd-opensfx
    buildsystem: simple
    build-commands:
      - tar -x -f opensfx-*.tar && rm opensfx-*.tar
      - mv opensfx-* $FLATPAK_DEST/share/games/openttd/baseset/opensfx
    sources:
      - type: archive
        url: https://cdn.openttd.org/opensfx-releases/1.0.1/opensfx-1.0.1-all.zip
        sha256: 37b825426f1d690960313414423342733520d08916f512f30f7aaf30910a36c5
        x-checker-data:
          type: anitya
          project-id: 88821
          stable-only: true
          url-template: https://cdn.openttd.org/opensfx-releases/$version/opensfx-$version-all.zip
